async function processarJSON(){try{const i="rptrs.json";let c;if(c=await async function(){if("undefined"==typeof window)try{if(fs.existsSync(i)){const o=fs.readFileSync(i,"utf8");return JSON.parse(o)}return new Promise((o,r)=>{https.get("https://radioid.net/static/rptrs.json",r=>{let a="";r.on("data",o=>a+=o),r.on("end",()=>o(JSON.parse(a)))}).on("error",r)})}catch(o){return console.error("Erro ao carregar JSON local, tentando URL...",o),new Promise((o,r)=>{https.get("https://radioid.net/static/rptrs.json",r=>{let a="";r.on("data",o=>a+=o),r.on("end",()=>o(JSON.parse(a)))}).on("error",r)})}else try{const o=await fetch(i);if(!o.ok)throw new Error("Falha ao carregar arquivo local");return await o.json()}catch(o){console.warn("Falha ao carregar rptrs.json local, tentando URL...");const r=await fetch("https://radioid.net/static/rptrs.json");if(!r.ok)throw new Error("Falha ao carregar da URL");return await r.json()}}(),!c.rptrs||!Array.isArray(c.rptrs))throw new Error('Estrutura do JSON inválida. Esperado objeto com propriedade "rptrs" array.');const p=",",l=o=>!isNaN(o)&&isFinite(o)?o:`"${o}"`,d=["CH","RX Freq","TX Freq","CH Mode","RX/TX Limit","TX Power","TOT","Scan Add","CH Alias","ID Type","CH ID","Dual Slot","Time Slot","Color Code","Promiscuous","TX Politely","TX Contacts","RX TG List","DMR Encryption","RX CTC DCS","TX CTC DCS","CTC DCS Type","Mute Code","Busy Lock","Demodulation","Tail Tone","Scrambler","Bandwidth","Offset"];function o(o){return"string"!=typeof o?o:(o=o.toLowerCase()).split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ")}function r(r){const a={};for(const[e,t]of Object.entries(r))a[e]="string"==typeof t?o(t):t;return a}function a(o){return o?o.replace(/TS/gi,"").trim().replace(/\s+/g," "):""}function e(o){const r={...o};return["frequency","offset","color_code","id"].forEach(o=>{void 0!==r[o]&&null!==r[o]&&(r[o]=parseFloat(r[o])||0)}),r}const f={acre:"ac",alagoas:"al",amapa:"ap","amapá":"ap",amazonas:"am",bahia:"ba",ceara:"ce","ceará":"ce","distrito federal":"df","espirito santo":"es","espírito santo":"es",goias:"go","goiás":"go",maranhao:"ma","maranhão":"ma","mato grosso":"mt","mato grosso do sul":"ms","minas gerais":"mg",para:"pa","pará":"pa",paraiba:"pb","paraíba":"pb",parana:"pr","paraná":"pr",pernambuco:"pe",piaui:"pi","piauí":"pi","rio de janeiro":"rj","rio grande do norte":"rn","rio grande do sul":"rs",rondonia:"ro","rondônia":"ro",roraima:"rr","santa catarina":"sc","sao paulo":"sp","são paulo":"sp",sergipe:"se",tocantins:"to",ac:"ac",al:"al",ap:"ap",am:"am",ba:"ba",ce:"ce",df:"df",es:"es",go:"go",ma:"ma",mt:"mt",ms:"ms",mg:"mg",pa:"pa",pb:"pb",pr:"pr",pe:"pe",pi:"pi",rj:"rj",rn:"rn",rs:"rs",ro:"ro",rr:"rr",sc:"sc",sp:"sp",se:"se",to:"to"};function t(o){if(!o)return"";const r=o.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();return f[r]||r}function s(r,a){if(!r)return"";let e=String(r);if(a){const o=Object.keys(f).find(o=>f[o]===a);if(o){o.split(" ").forEach(o=>{e=e.replace(new RegExp(`\\s*[\\-,\\.\\/]\\s*${o}`,"gi"),"")})}}return["mg","minas gerais","sp","sao paulo","são paulo","ac","acre","al","alagoas","ap","amapa","amapá","am","amazonas","ba","bahia","ce","ceara","ceará","df","distrito federal","es","espirito santo","espírito santo","go","goias","goiás","ma","maranhao","maranhão","mt","mato grosso","ms","mato grosso do sul","pa","para","pará","pb","paraiba","paraíba","pr","parana","paraná","pe","pernambuco","pi","piaui","piauí","rj","rio de janeiro","rn","rio grande do norte","rs","rio grande do sul","ro","rondonia","rondônia","rr","roraima","sc","santa catarina","se","sergipe","to","tocantins","brazil","brasil"].forEach(o=>{e=e.replace(new RegExp(`\\s*[\\-,\\.\\/]\\s*${o}`,"gi"),"")}),o(e.replace(/\s+/g," ").trim())}function n(o,r,e,t){function s(o){return`${parseFloat(o).toFixed(5)}`.padEnd(8,"0")}const n=parseFloat(o.frequency)||0,i=parseFloat(o.offset)||0,c=n+i,p=a(o.ts_linked).includes("2")?"2":"1";return[e,l(`${s(n)}`),l(`${s(c)}`),l("Digital"),l("RX+TX"),l("High"),l(60),l("Add"),l(t),l("Channel ID"),l(`${o.id||""}`),l("Off"),l(p),l(`${o.color_code||"1"}`),l("Off"),l("Allow TX"),l("All Call"),l("None"),l("None"),l("None"),l("None"),l("Normal"),l(0),l("Allow TX"),l("FM"),l("Off"),l("Off"),l("Wide"),l(`${i.toFixed(5)}`)]}const u={};for(const h in c.rptrs){const w=c.rptrs[h],b=String(w.status||"").trim().toLowerCase(),C=String(w.state||"").trim(),j=String(w.country||"").trim().toLowerCase();if(/bra(s|z)il/i.test(j.trim())&&"active"===b){const S=t(C);if(!S)continue;const{state:O,country:T,status:E,locator:R,callsign:N,map_info:L,trustee:F,map:U,...v}=w;v.city=s(v.city,S);const X=e(v);X.ts_linked&&(X.ts_linked=a(X.ts_linked));const A=r(X);u[S]||(u[S]=[]),u[S].push(A)}}const m="meta/"+i.replace(".json","");let g=0,y=0;for(const[k,D]of Object.entries(u)){D.sort((o,r)=>o.city.localeCompare(r.city));const J={[k]:D},q=`${m}.${k}.json`,_=`${m}.${k}.csv`;if("undefined"==typeof window)fs.writeFileSync(q,JSON.stringify(J,null,2));else{const B=new Blob([JSON.stringify(J,null,2)],{type:"application/json"}),M=URL.createObjectURL(B),I=document.createElement("a");I.href=M,I.download=q,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(M)}const x=[],z={};D.forEach(o=>{const r=`${k}:${o.city}`;z[r]=(z[r]||0)+1;const a=z[r],e=a>1?`${k.toUpperCase()}: ${o.city} [${a}]`:`${k.toUpperCase()}: ${o.city}`;x.push({registro:o,estado:k,chAlias:e})}),x.sort((o,r)=>o.registro.city.localeCompare(r.registro.city));let H=d.join(p)+"\n",P=1;if(x.forEach(o=>{const r=n(o.registro,o.estado,P++,o.chAlias);H+=r.join(p)+"\n"}),"undefined"==typeof window)fs.writeFileSync(_,H);else{const G=new Blob([H],{type:"text/csv"}),W=URL.createObjectURL(G),K=document.createElement("a");K.href=W,K.download=_,document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(W)}g++,y+=D.length,console.log(`Estado ${k.toUpperCase()}: ${D.length} registros`)}console.log("\nArquivos processados com sucesso!"),console.log(`Registros originais: ${c.rptrs.length}`),console.log(`Estados processados: ${g}`),console.log(`Total registros filtrados: ${y}`),console.log(`Arquivos gerados para cada estado: ${m}.{estado}.{json,csv}`)}catch(Q){console.error("Erro ao processar o arquivo:",Q.message)}}const fs="undefined"==typeof window?require("fs"):null,https="undefined"==typeof window?require("https"):null;"undefined"!=typeof window?window.processarJSON=processarJSON:processarJSON();