async function gerenciarCacheCidades(){try{if(isNODE&&fs.existsSync(__CIDADES_LOCAL)){const a=fs.statSync(__CIDADES_LOCAL).mtime.toISOString();try{const r=await commom._GET("https://api.github.com/repos/kelvins/Municipios-Brasileiros/commits?path=json/municipios.json&per_page=1");if(commom.V_RETURN(r)&&Array.isArray(r)&&r.length>0){const e=r[0].commit.committer.date;if(new Date(a)>=new Date(e))return console.log("Cache de cidades está atualizado"),carregarCidadesLocais()}}catch(a){return console.log("Não foi possível verificar atualizações, usando cache local"),carregarCidadesLocais()}}return await baixarEProcessarCidades()}catch(a){throw console.error("Erro no gerenciamento de cache de cidades:",a),a}}async function carregarCidadesLocais(){if(isNODE){const a=fs.readFileSync(__CIDADES_LOCAL,"utf8");return JSON.parse(a)}{const a=localStorage.getItem("brasil_cidades");if(a)return JSON.parse(a);throw new Error("Cache de cidades não disponível no browser")}}async function baixarEProcessarCidades(){console.log("Baixando lista atualizada de cidades...");const a=await commom._GET(__CIDADES_REPO);if(!commom.V_RETURN(a)||!Array.isArray(a))throw new Error("Falha ao baixar dados de cidades");const r=a.map(a=>a.nome.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));if(isNODE){const a=path.dirname(__CIDADES_LOCAL);fs.existsSync(a)||fs.mkdirSync(a,{recursive:!0}),fs.writeFileSync(__CIDADES_LOCAL,JSON.stringify(r,null,2)),console.log(`Lista de cidades salva em: ${__CIDADES_LOCAL}`)}else localStorage.setItem("brasil_cidades",JSON.stringify(r));return r}function inferirNomeCidade(a,r){if(!a||!r||!Array.isArray(r))return capitalizar(a);const e=a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/\s+/).filter(a=>a.length>2);for(const a of e){const e=r.find(r=>r===a);if(e)return capitalizar(e)}for(const a of r)for(const r of e)if(a.includes(r)||r.includes(a))return capitalizar(a);let i=null,o=.8;for(const a of r)for(const r of e){const e=calcularSimilaridadeJaroWinkler(r,a);e>o&&(o=e,i=a)}return i?capitalizar(i):capitalizar(e[0]||a)}function calcularSimilaridadeJaroWinkler(a,r){if(a===r)return 1;const e=a.length,i=r.length;if(0===e||0===i)return 0;const o=Math.floor(Math.max(e,i)/2)-1,s=new Array(e).fill(!1),t=new Array(i).fill(!1);let n=0,c=0;for(let c=0;c<e;c++){const e=Math.max(0,c-o),l=Math.min(c+o+1,i);for(let i=e;i<l;i++)if(!t[i]&&a[c]===r[i]){s[c]=!0,t[i]=!0,n++;break}}if(0===n)return 0;let l=0;for(let i=0;i<e;i++)if(s[i]){for(;!t[l];)l++;a[i]!==r[l]&&c++,l++}const d=(n/e+n/i+(n-c/2)/n)/3;let f=0;for(let o=0;o<Math.min(4,e,i)&&a[o]===r[o];o++)f++;return d+.1*f*(1-d)}const __CIDADES_REPO="https://raw.githubusercontent.com/kelvins/Municipios-Brasileiros/main/json/municipios.json",__CIDADES_LOCAL="/radio/repetidoras/cidades/brasil.cidades.json",__CIDADES_META=`${ROOT}/radio/repetidoras/cidades`;