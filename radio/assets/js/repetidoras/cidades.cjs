async function gerenciarCacheCidades(){return __CIDADES_CACHE||(__CIDADES_PROMISE||(__CIDADES_PROMISE=(async()=>{try{const e=await verificarSePrecisaBaixar();return!e&&isNODE&&fs.existsSync(__CIDADES_LOCAL)?(console.log("Carregando cidades do cache local..."),__CIDADES_CACHE=await carregarCidadesLocais()):(console.log(e?"Baixando versão atualizada de cidades...":"Baixando lista de cidades..."),__CIDADES_CACHE=await baixarEProcessarCidades()),__CIDADES_CACHE}catch(e){throw __CIDADES_PROMISE=null,console.error("Erro ao carregar cidades:",e),e}})(),__CIDADES_PROMISE))}async function verificarSePrecisaBaixar(){if(!isNODE||!fs.existsSync(__CIDADES_LOCAL))return!0;try{const e=await commom._GET("https://api.github.com/repos/kelvins/Municipios-Brasileiros/commits?path=json/municipios.json&per_page=1");if(commom.V_RETURN(e)&&Array.isArray(e)&&e.length>0){const a=new Date(e[0].commit.committer.date),i=fs.statSync(__CIDADES_LOCAL);return a>new Date(i.mtime)?(console.log("Versão mais recente disponível no repositório"),!0):(console.log("Cache local já está atualizado"),!1)}}catch(e){return console.log("Não foi possível verificar atualizações, usando cache local:",e.message),!1}return!1}async function carregarCidadesLocais(){if(isNODE){const e=fs.readFileSync(__CIDADES_LOCAL,"utf8");return JSON.parse(e)}{const e=localStorage.getItem("brasil_cidades");if(e)return JSON.parse(e);throw new Error("Cache de cidades não disponível")}}async function baixarEProcessarCidades(){const e=await commom._GET(__CIDADES_REPO);if(!commom.V_RETURN(e)||!Array.isArray(e))throw new Error("Falha ao baixar dados de cidades");const a=e.map(e=>e.nome.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));if(isNODE){const e=path.dirname(__CIDADES_LOCAL);fs.existsSync(e)||fs.mkdirSync(e,{recursive:!0}),fs.writeFileSync(__CIDADES_LOCAL,JSON.stringify(a,null,2)),console.log(`Lista de cidades salva em: ${__CIDADES_LOCAL}`)}else localStorage.setItem("brasil_cidades",JSON.stringify(a));return a}function inferirNomeCidade(e,a){if(!e||!a||!Array.isArray(a))return commom.capitalizar(e);const i=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();if(a.find(e=>e===i))return commom.capitalizar(e);if(i.split(" ").length<=2){const r=a.filter(e=>e.startsWith(i));if(1===r.length)return commom.capitalizar(r[0]);if(r.length>1){if(r.length>2)return commom.capitalizar(e)+"?";const a=["rio de janeiro","sao paulo","belo horizonte","brasilia","salvador","fortaleza","recife","porto alegre","curitiba","manaus"],i=r.find(e=>a.includes(e));return i?commom.capitalizar(i):commom.capitalizar(r[0])}}const r=a.filter(e=>e.includes(i)||i.includes(e));if(1===r.length)return commom.capitalizar(r[0]);if(r.length>3&&i.length<=5)return commom.capitalizar(e)+"?";const o=i.split(/\s+/).filter(e=>e.length>2);if(o.length>1){const e=a.filter(e=>o.every(a=>e.includes(a)));if(1===e.length)return commom.capitalizar(e[0]);if(o.length>=2){const e=o[0],i=o[o.length-1],r=a.filter(a=>a.includes(e)&&a.includes(i));if(1===r.length)return commom.capitalizar(r[0])}}let t=null,s=.9;for(const e of a){const a=calcularSimilaridadeJaroWinkler(i,e);a>s&&(s=a,t=e)}return t&&s>=.9?commom.capitalizar(t):commom.capitalizar(e)}function calcularSimilaridadeJaroWinkler(e,a){if(e===a)return 1;if(Math.abs(e.length-a.length)>5)return 0;const i=e.length,r=a.length;if(0===i||0===r)return 0;const o=Math.floor(Math.max(i,r)/2)-1,t=new Array(i).fill(!1),s=new Array(r).fill(!1);let n=0,c=0;for(let c=0;c<i;c++){const i=Math.max(0,c-o),l=Math.min(c+o+1,r);for(let r=i;r<l;r++)if(!s[r]&&e[c]===a[r]){t[c]=!0,s[r]=!0,n++;break}}if(0===n)return 0;let l=0;for(let r=0;r<i;r++)if(t[r]){for(;!s[l];)l++;e[r]!==a[l]&&c++,l++}const d=(n/i+n/r+(n-c/2)/n)/3;let m=0;for(let o=0;o<Math.min(3,i,r)&&e[o]===a[o];o++)m++;return d+.05*m*(1-d)}async function validarNomeCidade(e){try{const a=inferirNomeCidade(e,await gerenciarCacheCidades());return console.log(`Cidade corrigida: "${e}" → "${a}"`),a}catch(a){return console.error("Erro na validação de cidade:",a),commom.capitalizar(e)}}const isNODE="undefined"!=typeof process&&"object"==typeof process.versions&&!!process.versions.node,fs=isNODE?require("fs"):null,path=isNODE?require("path"):null,ROOT=isNODE?process.cwd().split("/radio/")[0]:"",__CIDADES_LOCAL=(e=>isNODE?path.resolve(e):e.replace(/\\/,"/"))(`${ROOT}/radio/repetidoras/cidades/brasil.cidades.json`),__CIDADES_REPO="https://raw.githubusercontent.com/kelvins/Municipios-Brasileiros/main/json/municipios.json",commom=isNODE?require("../../../../@assets/js/common.main.cjs"):"undefined"!=typeof window?window.commom:globalThis.commom;let __CIDADES_CACHE=null,__CIDADES_PROMISE=null;module.exports={validarNomeCidade:validarNomeCidade},"undefined"!=typeof globalThis&&(globalThis.cidades={validarNomeCidade:validarNomeCidade},"undefined"!=typeof window&&(window.cidades=globalThis.commom));