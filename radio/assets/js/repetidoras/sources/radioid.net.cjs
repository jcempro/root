async function processarRegistro(o,a){const{state:s,country:r,status:e,locator:t,callsign:i,map_info:n,trustee:c,map:p,city:l,...d}=o;if(!/bra(s|z)il/i.test((r||"").trim())||"active"!==(e||"").toLowerCase())return null;const g=normalizarEstado(s);if(!g)return null;const m=await processarNomeCidade(l,g);if(!m)return null;["frequency","offset","color_code","id"].forEach(o=>{null!=d[o]&&(d[o]=parseFloat(d[o])||0)}),d.info={},void 0!==d.frequency&&(d.rx=d.frequency,delete d.frequency),void 0!==d.color_code&&(d.color=d.color_code,delete d.color_code),void 0!==d.ts_linked&&(d.timeslot=converterTimeslot(d.ts_linked),delete d.ts_linked),void 0!==d.id&&(d.info.dmr_id=d.id,delete d.id),void 0!==d.ipsc_network&&(d.info.ipsc=d.ipsc_network,delete d.ipsc_network),void 0!==d.assigned&&(d.info.assigned=d.assigned,delete d.assigned),void 0!==d.rx&&void 0!==d.offset&&(d.tx=parseFloat((d.rx+d.offset).toFixed(5)));const f=`${g}:${m}`;a[f]=(a[f]||0)+1;a[f];return d.location=[g.toUpperCase(),m],Object.keys(d).forEach(o=>{"string"==typeof d[o]&&"location"!==o&&(d[o]=commom.capitalizar(d[o]))}),{estadoSigla:g,registro:d}}async function processarJSON(o,a,s,r=null,e=[PATH_FILE,__RPTDR_LNK],t="radioid.net"){try{const i=await a(e,t);if("object"!=typeof i||!Array.isArray(i?.rptrs))throw new Error("JSON inválido. Esperado objeto com '.rptrs'");const n={},c={},p={totalEstados:0,totalRegistros:0,registrosOriginais:i.rptrs.length,arquivosGerados:[],estadosProcessados:[],contents:{}};for(const o of i.rptrs){const a=await processarRegistro(o,c);if(a){const{estadoSigla:o,registro:s}=a;n[o]||(n[o]=[]),n[o].push(s)}}cacheProcessado=n;for(const[a,r]of Object.entries(n)){const e={};r.forEach(o=>{const s=o.location[1],r=`${a}:${s}`;e[r]=(e[r]||0)+1});const t={};r.forEach(o=>{const s=o.location[1],r=`${a}:${s}`;e[r]>1&&(t[r]=(t[r]||0)+1,o.location.push(t[r]))}),r.sort((o,a)=>o.location[1].localeCompare(a.location[1]));const i=o("",a),n=await s(r,i,a);p.contents[a]=r,p.totalEstados++,p.totalRegistros+=r.length,p.arquivosGerados.push(n),p.estadosProcessados.push(a),console.log(`Estado ${a.toUpperCase()}: ${r.length} registros`)}return console.log(`\nProcessado: ${p.totalEstados} estados, ${p.totalRegistros} registros (original: ${p.registrosOriginais})`),"function"==typeof r&&r(null,p),p}catch(o){throw console.error("Erro ao processar:",o),"function"==typeof r&&r(o,null),o}}const isNODE="undefined"==typeof window,CIDADES=isNODE?require("../cidades.main.cjs"):"undefined"!=typeof window?window.cidades:globalThis.cidades,__RPTDR_LNK="https://radioid.net/static/rptrs.json",PATH_FILE="rptrs.json",estadosMap={acre:"ac",alagoas:"al",amapa:"ap","amapá":"ap",amazonas:"am",bahia:"ba",ceara:"ce","ceará":"ce","distrito federal":"df","espirito santo":"es","espírito santo":"es",goias:"go","goiás":"go",maranhao:"ma","maranhão":"ma","mato grosso":"mt","mato grosso do sul":"ms","minas gerais":"mg",para:"pa","pará":"pa",paraiba:"pb","paraíba":"pb",parana:"pr","paraná":"pr",pernambuco:"pe",piaui:"pi","piauí":"pi","rio de janeiro":"rj","rio grande do norte":"rn","rio grande do sul":"rs",rondonia:"ro","rondônia":"ro",roraima:"rr","santa catarina":"sc","sao paulo":"sp","são paulo":"sp",sergipe:"se",tocantins:"to",ac:"ac",al:"al",ap:"ap",am:"am",ba:"ba",ce:"ce",df:"df",es:"es",go:"go",ma:"ma",mt:"mt",ms:"ms",mg:"mg",pa:"pa",pb:"pb",pr:"pr",pe:"pe",pi:"pi",rj:"rj",rn:"rn",rs:"rs",ro:"ro",rr:"rr",sc:"sc",sp:"sp",se:"se",to:"to"};let cacheProcessado=null;const normalizarEstado=o=>o&&estadosMap[o.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()]||"",converterTimeslot=o=>o?o.replace(/TS/gi,"").trim().split(/\s+/).map(o=>parseInt(o,10)).filter(o=>!isNaN(o)&&o>0):[],processarNomeCidade=async(o,a)=>{if(!o)return"";let s=String(o);const r=Object.keys(estadosMap).concat(["brazil","brasil"]);if(a){const o=Object.keys(estadosMap).find(o=>estadosMap[o]===a);if(o){o.split(" ").forEach(o=>{s=s.replace(new RegExp(`[\\-\\s\\/\\,\\.]+${o}[\\-\\s\\/\\,\\.]*$`,"gi"),"")})}}return r.forEach(o=>{s=s.replace(new RegExp(`[\\-\\s\\/\\,\\.]+${o}[\\-\\s\\/\\,\\.]*$`,"gi"),"")}),s=s.replace(/[\\-\\.\\/,\\|\\s]+$/,"").trim(),s=s.replace(/^[\\-\\.\\/,\\|\\s]+/,"").trim(),s=s.replace(/[\\-\\.\\/,\\|]+/g," "),s=s.replace(/\s+/g," ").trim(),s&&s.length>1?await CIDADES.validarNomeCidade(s):commom.capitalizar(o.replace(/[\\-\\.\\/,\\|]+/g," ").replace(/\s+/g," ").trim())};isNODE?module.exports={processarJSON:processarJSON}:window.processarJSON=processarJSON;