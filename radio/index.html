<!DOCTYPE html>
<html lang="pt-BR">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Carregando...</title>
	<style>
		.noscript,
		.lds {
			width: 3.75rem;
			height: 3.75rem;
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
		}

		.lds div {
			box-sizing: border-box;
			display: block;
			position: absolute;
			width: 3rem;
			height: 3rem;
			margin: 8px;
			border: 8px solid #333;
			border-radius: 50%;
			animation: lds 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
			border-color: #333 transparent transparent transparent;
		}

		.lds div:nth-child(1) {
			animation-delay: -0.45s;
		}

		.lds div:nth-child(2) {
			animation-delay: -0.3s;
		}

		.lds div:nth-child(3) {
			animation-delay: -0.15s;
		}

		@keyframes lds {
			0% {
				transform: rotate(0deg);
			}

			100% {
				transform: rotate(360deg);
			}
		}

		* {
			font-family: "Noto Sans", "Tahoma", "Arial", "Sans-serif" !important;
			line-height: 1.15em;
			margin: 0;
			padding: 0;
			color: #333;
		}

		.noscript {
			display: block;
			width: 280px;
			max-width: 280px;
			height: 160px;
			background: rgba(255, 255, 255, .9);
			padding: .5rem 1rem;
			border-left: .5rem solid #eee;
		}

		.noscript span {
			opacity: .6;
			font-size: .9rem;
		}

		.noscript p {
			margin-top: .5rem;
			font-weight: 600;
		}

		.noscript p span {
			font-size: 1.1rem;
		}

		body {
			margin: 0;
			padding: 40px;
			background-color: #f4f7f9;
			color: #333;
			line-height: 1.6;
		}

		.container {
			display: none;
			max-width: 600px;
			margin: auto;
			background: #fff;
			padding: 30px;
			border-radius: 12px;
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
			position: relative;
		}

		h1 {
			text-align: center;
			color: #333;
			margin-bottom: 10px;
			font-weight: 600;
		}

		ul,
		ul>li,
		p {
			text-align: justify;
			display: block;
			margin-top: .5em;
		}

		.desc {
			text-align: center;
			color: #333;
			margin-bottom: 30px;
		}

		div.dl {
			margin: 0;
			padding: 0;
			display: grid;
			grid-template-columns: 150px 1fr;
			gap: 15px;
			opacity: 0;
			transition: opacity 0.5s ease-in-out;
		}

		div.loaded {
			opacity: 1;
		}

		div.dt {
			font-weight: 600;
			color: #333;
			padding: 10px 0;
			text-transform: uppercase;
			font-size: 0.8em;
			letter-spacing: 0.5px;
		}

		div.dd {
			margin: 0;
			padding: 10px 0;
			border-bottom: 1px solid #eee;
			color: #333;
		}

		div.dd:last-of-type {
			border-bottom: none;
		}

		sup {
			font-size: .7em;
			font-style: italic;
		}

		span.url {
			background-color: #eee;
			padding: 0 .2em;
		}

		p.sub {
			font-size: .6em;
			font-weight: normal;
			margin: 1em 0;
		}

		.error-message {
			text-align: center;
			color: #e74c3c;
			margin-top: 20px;
			font-size: 1.2em;
		}

		@media (max-width: 600px) {
			.container {
				padding: 20px;
			}

			div.dl {
				grid-template-columns: 1fr;
			}

			div.dd {
				padding-top: 0;
				padding-bottom: 15px;
			}
		}
	</style>
</head>

<body>
	<div class="lds">
		<div></div>
		<div></div>
		<div></div>
		<div></div>
	</div>

	<div id="container" class="container">
		<h1 id="ttl">Carregando...</h1>
		<p class="desc"></p>

		<div class="dl"></div>

		<ul>
			<li>A validação de documentos Anatel está disponível em <a
					href="http://www.anatel.gov.br/autenticidade">anatel.gov.br</a></li>
			<li>Consultar peticionamento/processo <a
					href="https://sei.anatel.gov.br/sei/modulos/pesquisa/md_pesq_processo_pesquisar.php?acao_externa=protocolo_pesquisar&acao_origem_externa=protocolo_pesquisar&id_orgao_acesso_externo=0">aqui</a>
			</li>
		</ul>
	</div>

	<noscript><span>There is something <strong>wrong</strong> here!</span>
		<p><span>#noScript</span> <u>Javascript is disabled</u>, preventing us from directing you to the address.</p>
	</noscript>

	<script>
		const _ = e => document.querySelector(e);

		document.addEventListener("DOMContentLoaded", () => {
			_("#container").style.display = "block";

			const M1 = id => [id, `Dados de registro incorretas`, `O arquivo do registro existe, mas a formatação está incorreta, impedindo a exibição.`];
			const M2 = id => [id, `Parâmetro não encontrado ou inválido`, 'A url deve terminar com <span class="url">"/?<b>XXX</b>"</span>, onde "XXX" é o nº do peticionamento, despacho ou homologação Anatel sem pontuação.'];

			const ERR = (id, title, descri, exit) => {
				const m = `${title}${e_id(id)}\n\n<p class="sub">${descri}</p>`;
				TTL(m);
				if (typeof exit === "undefined" || exit === 1 || exit === true) throw new Error(m.replace(/<\/?[^>]+(>|$)/g, ``));
			};

			const C = `${window.location.search}`.split('radio/').pop().split(`?`).pop().replace(/[^a-z0-9\/]/i, '').trim().split(`/`);
			const CID = C[0];
			console.log(CID);
			if (/[^a-z0-9]/.test(CID)) ERR(...M2("1"));

			const CED = C.length >= 2 ? C[1] : false;
			const isL = v => /^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.test(v);

			const _L = y => {
				if (!Array.isArray(y)) return y;
				if (y.length === 0) return '---';
				if (typeof y[0] === 'string') {
					const l = isL(y[0] ? y[0] : y[1]);
					const t = isL(y[0] ? y[1] : y[0]);
					return `<a href="${l}" target="_blank">${t}</a>`;
				}
				if (!Array.isArray(y[0])) return '---';
				return y.map(_L).join('; ');
			};

			const _T = {
				"id": "Peticionamento/Processo",
				"r": "Despacho/Decisão/Homologação Anatel",
				"dt": "Emissão/consulta",
				"m": "Modelo",
			};

			const LOAD = _(".lds");
			const LST = _(".dl");
			const TTL = t => _("#ttl").innerHTML = document.title = t;
			const DESC = _(".desc");
			const e_id = id => id ? `<sup>[${id.toUpperCase()}]</sup>` : '';

			const A = (k, v) => {
				const dt = document.createElement("div");
				dt.className = "dt";
				dt.innerHTML = k === null ? `--` : k;
				const dd = document.createElement("div");
				dd.className = "dd";
				dd.innerHTML = k === null ? 'Item mal formatado' : v;
				LST.appendChild(dt);
				LST.appendChild(dd);
			};

			if (C) {
				const filePath = `db/${C}.json`;
				fetch(filePath)
					.then(response => {
						if (!response.ok) ERR(...M2("A"));
						return response.json();
					})
					.then(data => {
						LOAD.style.display = "none";

						for (const i of Object.keys(_T)) if (!Object.hasOwn(data, i)) ERR(...M1(`:${i}`));
						if (!Object.hasOwn(data, 'items') || !Array.isArray(data.items)) ERR(...M1('ITM1'));

						TTL(data.m || "Detalhes do Radio/Homologação");
						DESC.textContent = data.descricao || "";

						for (const j of [...Object.keys(_T), ...data.items]) {
							const val = Array.isArray(j) ? j : [_T[j] || null, _L(data[j])];
							A(val[0], val[1]);
							if (!val[0]) ERR(M1(`ITM2`));
						}

						LST.classList.add("loaded");
					})
					.catch(er => {
						console.error(filePath, "Erro:", er);
						ERR(...M2("B"));
					});
			} else {
				LOAD.style.display = "none";
				ERR(...M2("C"));
				DESC.textContent = "";
			}
		});
	</script>
</body>

</html>